#!/usr/bin/env python3
from neovim import attach
import os, sys

args = sys.argv[1:]
if not args:
    print("Usage: {} <filename> ...".format(sys.argv[0]))
    sys.exit(1)

addr = os.environ["NVIM"]
if not addr:
    # TODO: Open a new nvim instance if no addr
    sys.exit(2)

import os.path

nvim = attach("socket", path=addr)
def escapePath(name):
    return os.path.abspath(name).replace(" ", "\\ ")

def openFiles():
    # Leave terminal mode if necessary.
    nvim.feedkeys('', "n")

    # Select first window.
    nvim.command("1wincmd w")

    for x in args:
        nvim.command("drop {}".format(escapePath(x)))

openFiles()
